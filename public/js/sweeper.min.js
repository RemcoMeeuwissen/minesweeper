var field=[],lost=!1,tilesLeft=71,random=function(e,a){return Math.floor(Math.random()*(a-e+1))+e},generateBombs=function(){for(var e=[];e.length<10;){var a=random(0,8)+"-"+random(0,8)
e.indexOf(a)===-1&&e.push(a)}return e},buildField=function(e){for(var a=[];a.length<9;){for(var t=[];t.length<9;)t.push({state:"hidden",value:0})
a.push(t)}return e.map(function(e){var t=Number(e[0]),l=Number(e[2])
a[l][t].value="B"
for(var r=-1;r<=1;r++)for(var n=-1;n<=1;n++){var i=t+n,d=l+r
void 0!==a[d]&&void 0!==a[d][i]&&"B"!==a[d][i].value&&(a[d][i].value+=1)}}),a},createTable=function(){var e=document.createElement("table")
return field.map(function(a,t){var l=e.insertRow()
a.map(function(e,a){var r=l.insertCell()
if("hidden"===e.state){var n=document.createElement("a")
n.innerHTML=" ",n.href="/"+a+"-"+t,n.onclick=revealTile,n.setAttribute("aria-label","Reveal tile"),r.appendChild(n),r.className="hidden"}else if(0===e.value)r.appendChild(document.createTextNode(" "))
else{if("B"===e.value){var i=document.createElement("img")
i.src="/img/bomb.png",i.alt="Bomb"}else var i=document.createTextNode(e.value)
r.appendChild(i),1===e.value?r.className="number-one":2===e.value?r.className="number-two":3===e.value?r.className="number-three":4===e.value?r.className="number-four":5===e.value&&(r.className="number-five")}})}),e},drawTable=function(){var e=document.getElementById("field"),a=document.getElementsByTagName("table")[0]
if(e.replaceChild(createTable(field),a),lost===!0||tilesLeft<1){var t=document.getElementsByTagName("table")[0],l=void 0!==document.getElementsByClassName("alert")[0]
if(!l){if(lost)var r='<h1>You\'ve lost :(</h1><a href="/">click here to restart</a>'
else if(tilesLeft<1)var r='<h1>You\'ve won!</h1><a href="/">click here to restart</a>'
var n=document.createElement("div")
n.className="alert",n.innerHTML=r,e.insertBefore(n,t)}}},revealTile=function(e){e.preventDefault()
var a=function(e,t){if(void 0!==field[t]&&void 0!==field[t][e]&&"hidden"===field[t][e].state&&(field[t][e].state="shown",tilesLeft-=1,0===field[t][e].value))for(var l=-1;l<=1;l++)for(var r=-1;r<=1;r++)a(Number(e)+r,Number(t)+l)},t=e.currentTarget.href.slice(-3),l=t[0],r=t[2]
void 0!==field[r]&&void 0!==field[r][l]&&"hidden"===field[r][l].state&&(0===field[r][l].value?a(l,r):"B"===field[r][l].value?(field[r][l].state="shown",lost=!0):(field[r][l].state="shown",tilesLeft-=1),drawTable())}
field=buildField(generateBombs()),drawTable(field)
